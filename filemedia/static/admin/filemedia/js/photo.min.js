if(Dropzone.autoDiscover=!1,!FileManager)var FileManager={};FileManager={init:function(t){this.filemediaUploadImage(t),this.filemediaGetimage(t),this.fileMediaScrollImage(t),this.filemediaNextPage(t),this.filemediaPrevPage(t)},getCsrftoken:function(t){var e=null;if(document.cookie&&""!=document.cookie)for(var i=document.cookie.split(";"),a=0;a<i.length;a++){var d=jQuery.trim(i[a]);if(d.substring(0,t.length+1)==t+"="){e=decodeURIComponent(d.substring(t.length+1));break}}return e},reloadFreeWall:function(){var t=new freewall(".dropzone");return t.reset({selector:".dz-preview",animate:!0,gutterX:6,gutterY:6,cellW:125,cellH:125,onResize:function(){t.fitWidth()},onComplete:function(){}}),t.fitWidth()},filemediaUploadImage:function(t){var e=this,i=JSON.parse($(t).attr("data-filemedia-options")),a=$(t).attr("data-name");$("#add-image-"+a).dropzone({url:i.upload_url,addRemoveLinks:!1,previewsContainer:"#dropzone-preview-"+a,acceptedFiles:"image/*",maxFilesize:128,thumbnailWidth:115,thumbnailHeight:115,previewTemplate:'<div class="dz-preview"><img data-dz-thumbnail /><div style="text-align: center; width:inherit; position:absolute;margin-top:-25px"><span style="font-size:14px;"><a id="" class="add-tooltip btn-link img-delete" data-id="" href="javascript:;" data-original-title="'+gettext("Delete")+'"><i class="demo-pli-trash"></i></a></span></div><div class="dz-progress"><div class="progress progress-striped active" ><div data-dz-uploadprogress class="progress-bar progress-bar-success"></div></div></div></div>',success:function(i,a){if(a.status){$(i.previewTemplate).find(".dz-progress").remove(),$(i.previewTemplate).find("img").attr("style","cursor: pointer"),$(i.previewTemplate).find("img").attr("src",a.thmb.width100),$(i.previewTemplate).find("img").attr("rel",a.imagedefault),$(i.previewTemplate).find("img").attr("title",a.filename),$(i.previewTemplate).find("img").attr("data-id",a.imgid),$(i.previewTemplate).find("img").attr("data-uniquename",a.uniquename),$(i.previewTemplate).find("img").attr("data-path",a.path_date),$(i.previewTemplate).find("img").attr("data-imagedetail",a.thmb.width255),$(i.previewTemplate).find("img").attr("data-image256",a.thmb.width256),$(i.previewTemplate).find("img").attr("data-des",a.description),$(i.previewTemplate).find("a").attr("data-id",a.imgid),$(i.previewTemplate).find("a").attr("id","img"+a.imgid);var d="img"+a.imgid;e.deleteUploadImage(t,d),$(".img-delete").tooltip()}else $(i.previewTemplate).remove(),$.niftyNoty({type:"danger",icon:"pli-exclamation icon-2x",message:gettext(a.content),container:"floating",timer:5e3})},error:function(t,e){$.niftyNoty({type:"danger",icon:"pli-exclamation icon-2x",message:gettext(e),container:"floating",timer:5e3})},sending:function(t,d,n){n.append("csrfmiddlewaretoken",e.getCsrftoken("csrftoken"));var r=$("#dropzone-load-"+a).find(".dz-preview");if(r.length=18){var o=r.length-1;$(r[o]).remove()}e.reloadFreeWall();var m=$(t.previewTemplate).find("img");$(m).on("click",function(){var t='<img class="img-responsive thumbnail" data-imagedetail="'+$(m).attr("data-image256")+'" src="'+$(m).attr("data-imagedetail")+'" data-id="'+$(m).attr("data-id")+'" data-uniquename="'+$(m).attr("data-uniquename")+'" title="'+$(m).attr("title")+'">',d='<div id="form-img-detail-'+a+'"><input id="img-csrf" type="hidden" name="csrfmiddlewaretoken" value="'+e.getCsrftoken("csrftoken")+'"><input id="img-id" type="hidden" name="id" value="'+$(m).attr("data-id")+'"><input id="img-name" type="text" name="name" value="'+$(m).attr("title")+'" placeholder="'+gettext("Name")+'" class="form-control"><textarea id="img-des" name="description" style="height: 95px;" placeholder="'+gettext("Description")+'" rows="13" class="form-control mar-top">'+$(m).attr("data-des")+'</textarea><button data-dismiss="modal" type="button" class="btn btn-primary mar-top" id="btn-img-'+a+'">'+gettext("Insert")+"</button></div>";$("#img-detail-"+a).html(t+d),$("#btn-img-"+a).on("click",function(){var t=$("#img-detail-"+a).find("img");$("#img-"+a).attr("src",t.attr("data-imagedetail")),$("#id_img_"+a).val(t.attr("data-imagedetail")),$.ajax({dataType:"json",cache:!1,url:i.update_url,method:"POST",data:{csrfmiddlewaretoken:$("#form-img-detail-"+a).find("#img-csrf").val(),id:$("#form-img-detail-"+a).find("#img-id").val(),name:$("#form-img-detail-"+a).find("#img-name").val(),description:$("#form-img-detail-"+a).find("#img-des").val()},success:$.proxy(function(t){$("#modal-img-"+a).modal("hide"),$("#dropzone-preview-"+a).empty(),$("#dropzone-load-"+a).empty(),$("#img-detail-"+a).empty()},this)})})})}})},filemediaGetimage:function(t){var e=this,i=JSON.parse($(t).attr("data-filemedia-options")),a=$(t).attr("data-name");$.ajax({dataType:"json",cache:!1,url:i.load_url,data:{page:1},success:$.proxy(function(d){d.status?($.each(d.store,$.proxy(function(t,d){var n="";void 0!==d.title&&(n=d.title);var r=$('<div class="dz-preview" ><img data-path= "'+d.path_date+'" data-id="'+d.imgid+'" data-uniquename="'+d.uniquename+'" data-imagedetail="'+d.thmb.width255+'" src="'+d.thmb.width100+'" rel="'+d.image+'" title="'+n+'"  data-description="'+d.description+'" style="cursor: pointer;" ><div style="text-align: center; width:inherit; position:absolute;margin-top:-25px"><span style="font-size:14px;"><a class="add-tooltip btn-link img-delete" data-id="'+d.imgid+'" href="javascript:;" data-original-title="'+gettext("Delete")+'"><i class="demo-pli-trash"></i></a></span></div></div>');$(r).on("click",function(){var t='<img data-path= "'+d.path_date+'" class="img-responsive thumbnail" data-imagedetail="'+d.thmb.width256+'" src="'+d.thmb.width255+'" data-uniquename="'+d.uniquename+'" title="'+n+'"  data-description="'+d.description+'">',r='<div id="form-img-detail-'+a+'"><input id="img-csrf" type="hidden" name="csrfmiddlewaretoken" value="'+e.getCsrftoken("csrftoken")+'"><input id="img-id" type="hidden" name="id" value="'+d.imgid+'"><input id="img-name" type="text" name="name" value="'+n+'" placeholder="'+gettext("Name")+'" class="form-control"><textarea id="img-des" name="description" style="height: 95px;" placeholder="'+gettext("Description")+'" rows="13" class="form-control mar-top">'+d.description+'</textarea><button data-dismiss="modal" type="button" class="btn btn-primary mar-top" id="btn-img-'+a+'">'+gettext("Insert")+"</button></div>";$("#img-detail-"+a).html(t+r),$("#btn-img-"+a).on("click",function(){var t=$("#img-detail-"+a).find("img");$("#img-"+a).attr("src",t.attr("data-imagedetail")),$("#id_img_"+a).val(t.attr("data-imagedetail")),$.ajax({dataType:"json",cache:!1,url:i.update_url,method:"POST",data:{csrfmiddlewaretoken:$("#form-img-detail-"+a).find("#img-csrf").val(),id:$("#form-img-detail-"+a).find("#img-id").val(),name:$("#form-img-detail-"+a).find("#img-name").val(),description:$("#form-img-detail-"+a).find("#img-des").val()},success:$.proxy(function(t){t.status?($("#modal-img-"+a).modal("hide"),$("#dropzone-preview-"+a).empty(),$("#dropzone-load-"+a).empty(),$("#dropzone-"+a).attr("data-page","1"),$("#img-detail-"+a).empty()):($("#modal-img-"+a).modal("hide"),$("#dropzone-preview-"+a).empty(),$("#dropzone-load-"+a).empty(),$("#dropzone-"+a).attr("data-page","1"),$("#img-detail-"+a).empty(),$.niftyNoty({type:"danger",icon:"pli-exclamation icon-2x",message:gettext(t.content),container:"floating",timer:5e3}))},this)})})}),$("#dropzone-load-"+a).append(r),$(".img-delete").tooltip()},this)),e.reloadFreeWall(),e.deleteImage(t)):$.niftyNoty({type:"danger",icon:"pli-exclamation icon-2x",message:gettext(d.content),container:"floating",timer:5e3})},this)})},filemediaNextPage:function(t){var e=this,i=JSON.parse($(t).attr("data-filemedia-options")),a=$(t).attr("data-name");$("#img-next-"+a).on("click",function(){var d=$(this).attr("data-page");$.ajax({dataType:"json",cache:!1,url:i.load_url,data:{page:d},success:$.proxy(function(d){d.status?0!==d.leng&&($("#dropzone-preview-"+a).empty(),$("#dropzone-load-"+a).empty(),$("#img-prev-"+a).attr("data-page",d.pageprev),$("#img-next-"+a).attr("data-page",d.pagenext),$.each(d.store,$.proxy(function(t,d){var n="";void 0!==d.title&&(n=d.title);var r=$('<div class="dz-preview" ><img data-path= "'+d.path_date+'" data-id="'+d.imgid+'" data-uniquename="'+d.uniquename+'" data-imagedetail="'+d.thmb.width255+'" src="'+d.thmb.width100+'" rel="'+d.image+'" title="'+n+'"  data-description="'+d.description+'" style="cursor: pointer;" ><div style="text-align: center; width:inherit; position:absolute;margin-top:-25px"><span style="font-size:14px;"><a class="add-tooltip btn-link img-delete" data-id="'+d.imgid+'" href="javascript:;" data-original-title="'+gettext("Delete")+'"><i class="demo-pli-trash"></i></a></span></div></div>');$(r).on("click",function(){var t='<img data-path= "'+d.path_date+'" class="img-responsive thumbnail" data-imagedetail="'+d.thmb.width256+'"  src="'+d.thmb.width255+'" data-id="'+d.imgid+'" data-uniquename="'+d.uniquename+'" title="'+n+'"  data-description="'+d.description+'">',r='<div id="form-img-detail-'+a+'"><input id="img-csrf" type="hidden" name="csrfmiddlewaretoken" value="'+e.getCsrftoken("csrftoken")+'"><input id="img-id" type="hidden" name="id" value="'+d.imgid+'"><input id="img-name" type="text" name="name" value="'+n+'" placeholder="'+gettext("Name")+'" class="form-control"><textarea id="img-des" name="description" style="height: 95px;" placeholder="'+gettext("Description")+'" rows="13" class="form-control mar-top">'+d.description+'</textarea><button data-dismiss="modal" type="button" class="btn btn-primary mar-top" id="btn-img-'+a+'">'+gettext("Insert")+"</button></div>";$("#img-detail-"+a).html(t+r),$("#btn-img-"+a).on("click",function(){var t=$("#img-detail-"+a).find("img");$("#img-"+a).attr("src",t.attr("data-imagedetail")),$("#id_img_"+a).val(t.attr("data-imagedetail")),$.ajax({dataType:"json",cache:!1,url:i.update_url,method:"POST",data:{csrfmiddlewaretoken:$("#form-img-detail-"+a).find("#img-csrf").val(),id:$("#form-img-detail-"+a).find("#img-id").val(),name:$("#form-img-detail-"+a).find("#img-name").val(),description:$("#form-img-detail-"+a).find("#img-des").val()},success:$.proxy(function(t){$("#modal-img-"+a).modal("hide"),$("#dropzone-preview-"+a).empty(),$("#dropzone-load-"+a).empty(),$("#img-detail-"+a).empty()},this)})})}),$("#dropzone-load-"+a).append(r)},this)),e.reloadFreeWall(),e.deleteImage(t),$(".img-delete").tooltip()):$.niftyNoty({type:"danger",icon:"pli-exclamation icon-2x",message:gettext(d.content),container:"floating",timer:5e3})},this)})})},filemediaPrevPage:function(t){var e=this,i=JSON.parse($(t).attr("data-filemedia-options")),a=$(t).attr("data-name");$("#img-prev-"+a).on("click",function(){var d=$(this).attr("data-page");$.ajax({dataType:"json",cache:!1,url:i.load_url,data:{page:d},success:$.proxy(function(d){d.status?0!==d.leng&&($("#dropzone-preview-"+a).empty(),$("#dropzone-load-"+a).empty(),$("#img-prev-"+a).attr("data-page",d.pageprev),$("#img-next-"+a).attr("data-page",d.pagenext),$.each(d.store,$.proxy(function(t,d){var n="";void 0!==d.title&&(n=d.title);var r=$('<div class="dz-preview" ><img data-path= "'+d.path_date+'" data-id="'+d.imgid+'" data-uniquename="'+d.uniquename+'" data-imagedetail="'+d.thmb.width255+'" src="'+d.thmb.width100+'" rel="'+d.image+'" title="'+n+'"  data-description="'+d.description+'" style="cursor: pointer;" ><div style="text-align: center; width:inherit; position:absolute;margin-top:-25px"><span style="font-size:14px;"><a class="add-tooltip btn-link img-delete" data-id="'+d.imgid+'" href="javascript:;" data-original-title="'+gettext("Delete")+'"><i class="demo-pli-trash"></i></a></span></div></div>');$(r).on("click",function(){var t='<img data-path= "'+d.path_date+'" class="img-responsive thumbnail" data-imagedetail="'+d.thmb.width256+'"  src="'+d.thmb.width255+'" data-id="'+d.imgid+'" data-uniquename="'+d.uniquename+'" title="'+n+'"  data-description="'+d.description+'">',r='<div id="form-img-detail-'+a+'"><input id="img-csrf" type="hidden" name="csrfmiddlewaretoken" value="'+e.getCsrftoken("csrftoken")+'"><input id="img-id" type="hidden" name="id" value="'+d.imgid+'"><input id="img-name" type="text" name="name" value="'+n+'" placeholder="'+gettext("Name")+'" class="form-control"><textarea id="img-des" name="description" style="height: 95px;" placeholder="'+gettext("Description")+'" rows="13" class="form-control mar-top">'+d.description+'</textarea><button data-dismiss="modal" type="button" class="btn btn-primary mar-top" id="btn-img-'+a+'">'+gettext("Insert")+"</button></div>";$("#img-detail-"+a).html(t+r),$("#btn-img-"+a).on("click",function(){var t=$("#img-detail-"+a).find("img");$("#img-"+a).attr("src",t.attr("data-imagedetail")),$("#id_img_"+a).val(t.attr("data-imagedetail")),$.ajax({dataType:"json",cache:!1,url:i.update_url,method:"POST",data:{csrfmiddlewaretoken:$("#form-img-detail-"+a).find("#img-csrf").val(),id:$("#form-img-detail-"+a).find("#img-id").val(),name:$("#form-img-detail-"+a).find("#img-name").val(),description:$("#form-img-detail-"+a).find("#img-des").val()},success:$.proxy(function(t){$("#modal-img-"+a).modal("hide"),$("#dropzone-preview-"+a).empty(),$("#dropzone-load-"+a).empty(),$("#img-detail-"+a).empty()},this)})})}),$("#dropzone-load-"+a).append(r)},this)),e.reloadFreeWall(),e.deleteImage(t),$(".img-delete").tooltip()):$.niftyNoty({type:"danger",icon:"pli-exclamation icon-2x",message:gettext(d.content),container:"floating",timer:5e3})},this)})})},deleteUploadImage:function(t,e){var i=JSON.parse($(t).attr("data-filemedia-options")),a=this;$("#"+e).on("click",function(){var t=this,e=$(this).attr("data-id");$.ajax({dataType:"json",cache:!1,url:i.delete_url,method:"POST",data:{csrfmiddlewaretoken:a.getCsrftoken("csrftoken"),id:e},success:$.proxy(function(e){e.status?($.niftyNoty({type:"success",icon:"pli-exclamation icon-2x",message:gettext(e.content),container:"floating",timer:5e3}),$(t).parent().parent().parent().remove(),a.reloadFreeWall(),$("#img-detail-photo").empty()):$.niftyNoty({type:"danger",icon:"pli-exclamation icon-2x",message:gettext(e.content),container:"floating",timer:5e3})},this)})})},deleteImage:function(t){var e=JSON.parse($(t).attr("data-filemedia-options")),i=this;$(".img-delete").on("click",function(){var t=this,a=$(this).attr("data-id");$.ajax({dataType:"json",cache:!1,url:e.delete_url,method:"POST",data:{csrfmiddlewaretoken:i.getCsrftoken("csrftoken"),id:a},success:$.proxy(function(e){e.status?($.niftyNoty({type:"success",icon:"pli-exclamation icon-2x",message:gettext(e.content),container:"floating",timer:5e3}),$(t).parent().parent().parent().remove(),i.reloadFreeWall(),$("#img-detail-photo").empty()):$.niftyNoty({type:"danger",icon:"pli-exclamation icon-2x",message:gettext(e.content),container:"floating",timer:5e3})},this)})})},fileMediaScrollImage:function(t){JSON.parse($(t).attr("data-filemedia-options"));var e=$(t).attr("data-name");$("#slim-scroll-"+e).slimScroll({height:"380px",color:"#1e3a57",opacity:.8,borderRadius:0,railVisible:!0,size:"4px"})}},$(document).on("nifty.ready",function(){$(".img-filemedia").unbind("click").click(function(t){var e=$(this).attr("data-name");FileManager.init(this),$("#img-modal-close-"+e).on("click",function(){$("#modal-img-"+e).modal("hide"),$("#dropzone-preview-"+e).empty(),$("#dropzone-load-"+e).empty(),$("#dropzone-"+e).attr("data-page","1")})})});