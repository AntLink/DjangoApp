function getCsrftoken(e){var t=null;if(document.cookie&&""!=document.cookie)for(var i=document.cookie.split(";"),a=0;a<i.length;a++){var n=jQuery.trim(i[a]);if(n.substring(0,e.length+1)==e+"="){t=decodeURIComponent(n.substring(e.length+1));break}}return t}Dropzone.autoDiscover=!1,$(document).on("nifty.ready",function(){$(".dropzone").on("click",function(){var e=JSON.parse($(this).attr("data-filemedia-options")),t=$(this).attr("data-name"),i=$(this).attr("data-objectid");$("#img-"+t).dropzone({url:e.upload_url,addRemoveLinks:!1,dictDefaultMessage:"",previewsContainer:"#dropzone-preview-"+t,acceptedFiles:"image/*",maxFilesize:128,thumbnailWidth:150,uploadMultiple:!1,parallelUploads:1,thumbnailHeight:150,maxFiles:1,previewTemplate:'<div class="dz-preview"><img data-dz-thumbnail class="img-responsive img-rounded dz-clickable" style="width: 125px"/><div class="dz-progress" style="width: 110px;margin-left: 8px; margin-top: -65px; position: absolute;"><div class="progress progress-striped active"><div data-dz-uploadprogress class="progress-bar progress-bar-success"></div></div></div></div>',success:function(e,i){i.status?($(e.previewTemplate).find(".dz-progress").remove(),$(e.previewTemplate).find("img").attr("id","img-"),$(e.previewTemplate).find("img").attr("src",i.thmb.width150),$(e.previewTemplate).find("img").attr("rel",i.imagedefault),$(e.previewTemplate).find("img").attr("title",i.filename),$(e.previewTemplate).find("img").attr("data-id",i.imgid),$(e.previewTemplate).find("img").attr("data-uniquename",i.uniquename),$(e.previewTemplate).find("img").attr("data-path",i.path_date),$(e.previewTemplate).find("img").attr("data-imagedetail",i.thmb.width356),$(e.previewTemplate).find("img").attr("data-image150",i.thmb.width150),$(e.previewTemplate).find("img").attr("data-des",i.description),$("#dropzone-get-"+t+" img").attr("src",i.thmb.width150),$("#dropzone-get-"+t+" img").fadeIn(),$("#id_img_"+t).val(i.uniquename)):($(e.previewTemplate).remove(),$.niftyNoty({type:"danger",icon:"pli-exclamation icon-2x",message:gettext(i.data),container:"floating",timer:5e3}))},error:function(e,t){$.niftyNoty({type:"danger",icon:"pli-exclamation icon-2x",message:gettext(t),container:"floating",timer:5e3})},sending:function(e,a,n){n.append("csrfmiddlewaretoken",getCsrftoken("csrftoken")),n.append("object_id",i),$("#dropzone-get-"+t+" img").hide()},init:function(){this.on("complete",function(e){this.removeAllFiles(!0)})}})})});