function getCsrftoken(e){var i=null;if(document.cookie&&""!=document.cookie)for(var t=document.cookie.split(";"),a=0;a<t.length;a++){var n=jQuery.trim(t[a]);if(n.substring(0,e.length+1)==e+"="){i=decodeURIComponent(n.substring(e.length+1));break}}return i}function reloadFreeWall(){var e=new freewall(".dropzone"),i=$(".panel-body").width()/24*3;return e.reset({selector:".dz-preview",animate:!0,gutterX:10,gutterY:10,cellW:i,cellH:i,delay:10,onResize:function(){var i=$(".panel-body").width()/24*3;this.reset({selector:".dz-preview",gutterX:10,gutterY:10,cellW:i,cellH:i,delay:10}),e.refresh()}}),e.fitWidth()}Dropzone.autoDiscover=!1,$(document).on("nifty.ready",function(){reloadFreeWall(),$("#add-image-grid").dropzone({url:imguploadURL,addRemoveLinks:!1,previewsContainer:"#dropzone-grid-preview",acceptedFiles:"image/*",maxFilesize:128,thumbnailWidth:144,thumbnailHeight:144,previewTemplate:"<span></span>",success:function(e,i){$(e.previewTemplate).remove();var t=e.size+e.lastModified;i.status?($(".img-"+t).find(".magic-checkbox").attr("value",i.imgid),$(".img-"+t).find("img").attr("src",i.thmb.width100),$(".img-"+t).find(".change-link").attr("href",i.imgchange_link),$(".img-"+t).find(".delete-link").attr("href",i.imgdelete_link),$(".img-"+t).find(".view-link").attr("href",i.imgview_link),$(".img-"+t).find(".progress").hide(),$(".img-"+t).find(".img-meta-link").css({"margin-top":"-25px"}),$(".img-from").text(" 1 - "+i.imgcount),$(".img-to").text(i.imgcount),$(".add-tooltip").tooltip()):($(".img-"+t).remove(),$.niftyNoty({type:"danger",icon:"pli-exclamation icon-2x",message:gettext(i.content),container:"floating",timer:5e3}),reloadFreeWall())},error:function(e,i){$.niftyNoty({type:"danger",icon:"pli-exclamation icon-2x",message:gettext(i.content),container:"floating",timer:5e3})},sending:function(e,i,t){t.append("csrfmiddlewaretoken",getCsrftoken("csrftoken")),"undefined"!=typeof taxID&&t.append("taxid",taxID),"True"==canupload&&"True"==candelete&&($("#image-alert").remove(),$("#panel-image").fadeIn());var a=e.size+e.lastModified,n="img-"+a,l="progress-"+a,s="True"==canchange?'<a class="change-link add-tooltip btn-link" title="" href="#" data-original-title="'+gettext("Change")+'"><i class="demo-pli-pen-5"></i></a>&nbsp;':"",d="True"==candelete?'<a class="delete-link add-tooltip btn-link" title="" href="#" data-original-title="'+gettext("Delete")+'"><i class="demo-pli-trash"></i></a>':"",r="True"==candownload?'<a target="_blank" class="view-link add-tooltip btn-link" title="" href="javascript:;" data-original-title="'+gettext("Download")+'"><i class="demo-pli-download-from-cloud"></i></a>&nbsp;':"";$("#dropzone").prepend('<div class="dz-preview '+n+'"><div class="file-control"><input type="checkbox" name="_selected_action" class="magic-checkbox" id="list-'+a+'"><label for="list-'+a+'"></label></div><img src="/static/admin/filemedia/img/no-thumb/td_100x100.png" alt="Image"/><div class="img-meta-link" style="text-align: center; width:inherit; position:absolute;"><div class="progress progress-striped active" style="margin-top:-68px;margin-right: 10px;margin-left: 10px;margin-bottom: 30px;"><div id="'+l+'" class="progress-bar progress-bar-success"></div></div><span style="font-size:14px;">'+s+r+d+"</span></div></div>"),reloadFreeWall()},thumbnail:function(e,i){var t=e.size+e.lastModified;$(".img-"+t).find("img").attr("src",i),$(".img-"+t).fadeIn(),reloadFreeWall()},uploadprogress:function(e,i,t){var a=e.size+e.lastModified;$("#progress-"+a).css({width:i+"%"})}}),$("#add-image-list").dropzone({url:imguploadURL,addRemoveLinks:!1,previewsContainer:"#dropzone-list-preview",acceptedFiles:"image/*",maxFilesize:128,thumbnailWidth:50,thumbnailHeight:50,previewTemplate:"<span></span>",success:function(e,i){$(e.previewTemplate).remove();var t=e.size+e.lastModified;i.status?($("#img-"+t).find(".magic-checkbox").attr("value",i.imgid),$("#img-"+t).find("img").attr("src",i.thmb.width100),$("#img-"+t).find(".change-link").attr("href",i.imgchange_link),$("#img-"+t).find(".delete-link").attr("href",i.imgdelete_link),$("#img-"+t).find(".view-link").attr("href",i.imgview_link),$("#img-"+t).find(".progress").hide(),$("#img-"+t).find(".file-name").text(i.name),$("#img-"+t).find(".file-date").text(i.created_at+" | "+i.filesize),$(".img-from").text(" 1 - "+i.imgcount),$(".img-to").text(i.imgcount)):($("#img-"+t).remove(),$.niftyNoty({type:"danger",icon:"pli-exclamation icon-2x",message:gettext(i.content),container:"floating",timer:5e3}))},error:function(e,i){$.niftyNoty({type:"danger",icon:"pli-exclamation icon-2x",message:gettext(i.content),container:"floating",timer:5e3})},sending:function(e,i,t){t.append("csrfmiddlewaretoken",getCsrftoken("csrftoken")),"undefined"!=typeof taxID&&t.append("taxid",taxID),"True"==canupload&&"True"==candelete&&($("#image-alert").remove(),$("#panel-image").fadeIn());var a=e.size+e.lastModified,n="img-"+a,l="progress-"+a,s="True"==canchange?'<li><a class="btn-link change-link" style="width:100%" href="#"><i class="demo-pli-pen-5"></i> '+gettext("Change")+"</a></li>":"",d="True"==candelete?'<li><a class="btn-link delete-link" style="width:100%" href="#"><i class="demo-pli-trash"></i> '+gettext("Delete")+"</a></li>":"",r="True"==candownload?'<li><a target="_blank" class="btn-link view-link" style="width:100%" href="javascript:;"><i class="demo-pli-download-from-cloud"></i> '+gettext("Download")+"</a></li>":"",o="True"==candelete?'<div class="file-control" style="width: 30px;"><input type="checkbox" name="_selected_action" value="104" class="magic-checkbox" id="list-'+a+'"><label for="list-'+a+'"></label></div>':"",c="";"True"!=canchange&&"True"!=candelete&&"True"!=candownload||(c='<button class="btn btn-icon" data-toggle="dropdown" type="button" aria-expanded="false"><i class="pci-ver-dots"></i></button>'),$("#list-items").prepend('<li id="'+n+'">'+o+'<div class="file-settings dropdown">'+c+'<ul class="dropdown-menu dropdown-menu-right with-arrow" style="right:-6px"> '+s+d+r+'</ul> </div><div class="file-details"> <div class="media-block"> <div class="media-left"><img class="file-img img-responsive" style="width:40px" src="/static/admin/filemedia/img/no-thumb/td_100x100.png" alt="upload"></div><div class="media-body"> <div class="progress progress-striped active" style="margin-top:15px;"><div id="'+l+'" class="progress-bar progress-bar-success"></div></div><p class="file-name"></p><small class="file-date"></small> </div></div></div></li>'),$("#img"+a).hide()},thumbnail:function(e,i){var t=e.size+e.lastModified;$("#img-"+t).find("img").attr("src",i),$("#img-"+t).fadeIn()},uploadprogress:function(e,i,t){var a=e.size+e.lastModified;$("#progress-"+a).css({width:i+"%"})}})});