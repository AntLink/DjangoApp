function getCsrftoken(e){var i=null;if(document.cookie&&""!=document.cookie)for(var t=document.cookie.split(";"),l=0;l<t.length;l++){var a=jQuery.trim(t[l]);if(a.substring(0,e.length+1)==e+"="){i=decodeURIComponent(a.substring(e.length+1));break}}return i}Dropzone.autoDiscover=!1,$(document).on("nifty.ready",function(){$("#add-files").dropzone({url:fileUploadURL,addRemoveLinks:!1,previewsContainer:"#dropzone-list-file-preview",maxFilesize:1024,previewTemplate:"<span></span>",success:function(e,i){$(e.previewTemplate).remove();var t=e.lastModified+e.size;i.status?($("#file-"+t).find(".magic-checkbox").attr("value",i.id),$("#file-"+t).find(".change-link").attr("href",i.change_link),$("#file-"+t).find(".delete-link").attr("href",i.delete_link),$("#file-"+t).find(".download-link").attr("href",i.download_link),$("#file-"+t).find(".progress").hide(),$("#file-"+t).find(".file-name").text(i.name),$("#file-"+t).find(".file-date").text(i.created_at+" | "+i.filesize),$(e.previewTemplate).find(".progress").hide(),$(".file-from").text(" 1 - "+i.count),$(".file-to").text(i.count)):($("#file-"+t).remove(),$.niftyNoty({type:"danger",icon:"pli-exclamation icon-2x",message:gettext(i.data),container:"floating",timer:5e3}))},error:function(e,i){$.niftyNoty({type:"danger",icon:"pli-exclamation icon-2x",message:gettext(i),container:"floating",timer:5e3})},sending:function(e,i,t){t.append("csrfmiddlewaretoken",getCsrftoken("csrftoken"));var l=e.lastModified+e.size;"True"==canupload&&"True"==candelete&&($("#file-alert").remove(),$("#panel-file").fadeIn());var a="";"True"!=canchange&&"True"!=candelete&&"True"!=candownload||(a='<button class="btn btn-icon" data-toggle="dropdown" type="button" aria-expanded="false"><i class="pci-ver-dots"></i></button>');var n="True"==canchange?'<li><a class="btn-link change-link" style="width:100%" href="#"><i class="demo-pli-pen-5"></i> '+gettext("Change")+"</a></li>":"",s="True"==candelete?'<li><a class="btn-link delete-link" style="width:100%" href="#"><i class="demo-pli-trash"></i> '+gettext("Delete")+"</a></li>":"",d="True"==candownload?'<li><a target="_blank" class="btn-link download-link" style="width:100%" href="javascript:;"><i class="demo-pli-download-from-cloud"></i> '+gettext("Download")+"</a></li>":"",o="True"==candelete?'<div class="file-control" style="width: 33px;"><input type="checkbox" name="_selected_action" class="magic-checkbox" id="list-'+l+'"><label for="list-'+l+'"></label></div>':"";$("#files-list").prepend('<li id="file-'+l+'"> '+o+'<div class="file-settings dropdown"> '+a+'<ul class="dropdown-menu dropdown-menu-right with-arrow" style="right:-6px"> '+n+s+d+'</ul> </div><div class="file-details"> <div class="media-block"> <div class="media-left"><i class="demo-pli-file"></i></div><div class="media-body"> <div class="progress progress-striped active" style="margin-top:15px;"><div id="progress-'+l+'" class="progress-bar progress-bar-success"></div></div><p class="file-name"></p><small class="file-date"></small> </div></div></div></li>'),"undefined"!=typeof taxID&&t.append("taxid",taxID)},uploadprogress:function(e,i,t){var l=e.lastModified+e.size;$("#progress-"+l).css({width:i+"%"})}})});